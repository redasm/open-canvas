# Open Canvas 开发环境配置指南

## 📋 目录

1. [系统要求](#系统要求)
2. [环境准备](#环境准备)
3. [项目配置](#项目配置)
4. [调试配置](#调试配置)
5. [常见问题](#常见问题)
6. [性能优化](#性能优化)

## 💻 系统要求

### 最低配置
- **操作系统**: Windows 10, macOS 10.15, Ubuntu 18.04
- **Node.js**: 18.x 或更高版本 (推荐 20.x)
- **内存**: 8GB RAM (推荐 16GB)
- **存储**: 10GB 可用空间
- **网络**: 稳定的互联网连接

### 推荐配置
- **操作系统**: Windows 11, macOS 12+, Ubuntu 20.04+
- **Node.js**: 20.x LTS
- **内存**: 16GB RAM
- **存储**: 20GB 可用空间 (SSD 推荐)
- **CPU**: 多核处理器 (4+ 核心推荐)

### 开发工具
- **IDE**: VS Code (推荐)
- **包管理器**: Yarn 1.22.22
- **Git**: 2.30+ 版本
- **浏览器**: Chrome, Firefox, Safari, Edge

## 🛠️ 环境准备

### 1. 安装 Node.js

#### Windows
```bash
# 使用 Chocolatey
choco install nodejs

# 或下载安装包
# https://nodejs.org/en/download/
```

#### macOS
```bash
# 使用 Homebrew
brew install node

# 或使用 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20
```

#### Linux (Ubuntu)
```bash
# 使用 NodeSource 仓库
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# 或使用 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20
```

### 2. 安装 Yarn

```bash
# 全局安装 Yarn
npm install -g yarn

# 验证安装
yarn --version
```

### 3. 安装 Git

#### Windows
```bash
# 使用 Chocolatey
choco install git

# 或下载安装包
# https://git-scm.com/download/win
```

#### macOS
```bash
# 使用 Homebrew
brew install git

# 或使用 Xcode Command Line Tools
xcode-select --install
```

#### Linux
```bash
# Ubuntu/Debian
sudo apt-get install git

# CentOS/RHEL
sudo yum install git
```

### 4. 安装 VS Code (推荐)

#### 安装 VS Code
- 下载: [https://code.visualstudio.com/](https://code.visualstudio.com/)

#### 推荐扩展
```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint",
    "ms-vscode.vscode-json",
    "ms-vscode.vscode-node-debug2",
    "ms-vscode.vscode-chrome-debug"
  ]
}
```

## 🚀 项目配置

### 1. 克隆项目

```bash
# 克隆仓库
git clone https://github.com/langchain-ai/open-canvas.git
cd open-canvas

# 检查分支
git branch -a
```

### 2. 安装依赖

```bash
# 安装所有依赖
yarn install

# 如果遇到网络问题，可以使用国内镜像
yarn config set registry https://registry.npmmirror.com
yarn install
```

### 3. 构建项目

```bash
# 构建所有包
yarn build

# 如果构建失败，清理后重新构建
yarn clean
yarn build
```

### 4. 环境变量配置

#### 根目录 `.env` 文件
```bash
# 复制示例文件
cp .env.example .env

# 编辑配置文件
# 添加必需的 API 密钥
```

#### `apps/web/.env` 文件
```bash
# 进入 web 目录
cd apps/web

# 复制示例文件
cp .env.example .env

# 编辑配置文件
# 添加 Supabase 配置
```

### 5. Supabase 配置

#### 创建 Supabase 项目
1. 访问 [https://supabase.com/dashboard/projects](https://supabase.com/dashboard/projects)
2. 点击 "New Project"
3. 填写项目信息
4. 等待项目创建完成

#### 获取配置信息
1. 进入项目设置 → API
2. 复制以下信息：
   - `Project URL`
   - `anon public` key
   - `service_role` key

#### 配置认证
1. 进入 Authentication → Providers
2. 启用 Email 认证
3. 可选：启用 GitHub/Google 认证

### 6. API 密钥配置

#### OpenAI
```bash
# 获取 API 密钥
# https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-...
```

#### Anthropic
```bash
# 获取 API 密钥
# https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-...
```

#### LangSmith
```bash
# 获取 API 密钥
# https://smith.langchain.com/
LANGCHAIN_API_KEY=lsv2_...
LANGCHAIN_TRACING_V2=true
LANGCHAIN_PROJECT=open-canvas-local
```

## 🔧 调试配置

### 1. VS Code 调试配置

#### 创建 `.vscode/launch.json`
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "🤖 Debug LangGraph Agents (Simple)",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/debug-agents.js",
      "console": "integratedTerminal",
      "env": {
        "NODE_OPTIONS": "--inspect=9230"
      },
      "skipFiles": [
        "<node_internals>/**"
      ],
      "presentation": {
        "hidden": false,
        "group": "backend",
        "order": 2
      }
    },
    {
      "name": "🌐 Debug Frontend (Browser)",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000",
      "webRoot": "${workspaceFolder}/apps/web/src",
      "sourceMaps": true,
      "userDataDir": "${workspaceFolder}/.vscode/chrome-debug-profile",
      "runtimeExecutable": "${env:PROGRAMFILES(X86)}\\Microsoft\\Edge\\Application\\msedge.exe",
      "presentation": {
        "hidden": false,
        "group": "frontend",
        "order": 3
      }
    }
  ]
}
```

#### 创建 `debug-agents.js`
```javascript
// debug-agents.js
const { spawn } = require('child_process');
const path = require('path');

console.log('🚀 Starting LangGraph Agents with debugging...');

// 使用 yarn 而不是 npm，因为项目使用 yarn
const child = spawn('yarn', ['dev'], {
  cwd: path.join(__dirname, 'apps/agents'),
  stdio: 'inherit',
  env: {
    ...process.env,
    NODE_OPTIONS: '--inspect=9230'
  }
});

child.on('error', (error) => {
  console.error('❌ Failed to start:', error);
});

child.on('exit', (code, signal) => {
  console.log(`LangGraph agents exited with code ${code} and signal ${signal}`);
});
```

### 2. 调试技巧

#### 前端调试
```typescript
// 在 React 组件中添加调试
console.log('Component state:', state);
console.log('Props:', props);

// 使用 React DevTools
// 安装 React Developer Tools 浏览器扩展
```

#### 后端调试
```typescript
// 在 LangGraph 节点中添加调试
console.log('Node execution started', { state, config });
console.log('Model response:', response);

// 使用 LangGraph Studio
// 访问: https://smith.langchain.com/studio?baseUrl=http://localhost:54367
```

#### 网络调试
```typescript
// 在 API 路由中添加调试
console.log('API request:', { method, url, body });
console.log('API response:', { status, data });
```

### 3. 日志配置

#### 结构化日志
```typescript
// 创建日志工具
const logger = {
  info: (message: string, data?: any) => {
    console.log(JSON.stringify({
      timestamp: new Date().toISOString(),
      level: 'info',
      message,
      data
    }));
  },
  error: (message: string, error?: any) => {
    console.error(JSON.stringify({
      timestamp: new Date().toISOString(),
      level: 'error',
      message,
      error: error?.message || error
    }));
  }
};
```

#### 环境变量控制
```bash
# 开发环境日志级别
LOG_LEVEL=debug

# 生产环境日志级别
LOG_LEVEL=info
```

## ❓ 常见问题

### 1. 安装问题

#### Q: `yarn install` 失败
```bash
# 清理缓存
yarn cache clean

# 删除 node_modules 和 yarn.lock
rm -rf node_modules yarn.lock

# 重新安装
yarn install
```

#### Q: 构建失败
```bash
# 清理构建缓存
yarn clean

# 重新构建
yarn build

# 如果还是失败，检查 TypeScript 错误
yarn tsc --noEmit
```

#### Q: 端口被占用
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# macOS/Linux
lsof -ti:3000 | xargs kill -9
```

### 2. 配置问题

#### Q: 环境变量不生效
```bash
# 检查环境变量文件
cat .env

# 重启开发服务器
# 环境变量更改后需要重启
```

#### Q: Supabase 连接失败
```bash
# 检查 Supabase 配置
echo $NEXT_PUBLIC_SUPABASE_URL
echo $NEXT_PUBLIC_SUPABASE_ANON_KEY

# 测试连接
curl -H "apikey: $NEXT_PUBLIC_SUPABASE_ANON_KEY" $NEXT_PUBLIC_SUPABASE_URL/rest/v1/
```

#### Q: API 密钥无效
```bash
# 检查 API 密钥格式
echo $OPENAI_API_KEY | head -c 10

# 测试 API 调用
curl -H "Authorization: Bearer $OPENAI_API_KEY" https://api.openai.com/v1/models
```

### 3. 运行时问题

#### Q: 热重载不工作
```bash
# 检查文件监听限制
# macOS/Linux
echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf

# 重启开发服务器
```

#### Q: 内存不足
```bash
# 增加 Node.js 内存限制
export NODE_OPTIONS="--max-old-space-size=4096"

# 或在 package.json 中设置
"scripts": {
  "dev": "NODE_OPTIONS='--max-old-space-size=4096' next dev"
}
```

#### Q: 类型错误
```bash
# 检查 TypeScript 配置
yarn tsc --noEmit

# 修复类型错误
yarn lint:fix
```

### 4. 调试问题

#### Q: 断点不生效
```bash
# 检查 source maps
# 确保 sourceMaps: true 在配置中

# 检查文件路径
# 确保 webRoot 配置正确
```

#### Q: LangGraph Studio 无法访问
```bash
# 检查 LangGraph 服务是否运行
curl http://localhost:54367/health

# 检查防火墙设置
# 确保端口 54367 可访问
```

## ⚡ 性能优化

### 1. 开发环境优化

#### 构建优化
```bash
# 使用增量构建
yarn build --filter=...

# 并行构建
yarn build --parallel
```

#### 内存优化
```bash
# 设置 Node.js 内存限制
export NODE_OPTIONS="--max-old-space-size=4096"

# 使用 swap 文件 (Linux)
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

#### 网络优化
```bash
# 使用国内镜像
yarn config set registry https://registry.npmmirror.com

# 配置代理 (如果需要)
yarn config set proxy http://proxy.company.com:8080
yarn config set https-proxy http://proxy.company.com:8080
```

### 2. IDE 优化

#### VS Code 设置
```json
{
  "typescript.preferences.includePackageJsonAutoImports": "on",
  "typescript.suggest.autoImports": true,
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "files.watcherExclude": {
    "**/node_modules/**": true,
    "**/dist/**": true,
    "**/.turbo/**": true
  }
}
```

#### 扩展优化
```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint"
  ]
}
```

### 3. 系统优化

#### 文件系统优化
```bash
# 使用 SSD (推荐)
# 配置适当的文件系统
# ext4 (Linux), APFS (macOS), NTFS (Windows)
```

#### 网络优化
```bash
# 使用稳定的网络连接
# 配置适当的 DNS 服务器
# 8.8.8.8, 1.1.1.1
```

## 📚 参考资源

### 官方文档
- [Node.js 文档](https://nodejs.org/docs/)
- [Yarn 文档](https://yarnpkg.com/docs)
- [Next.js 文档](https://nextjs.org/docs)
- [LangGraph 文档](https://langchain-ai.github.io/langgraphjs/)
- [LangChain 文档](https://js.langchain.com/docs/)

### 开发工具
- [VS Code](https://code.visualstudio.com/)
- [React Developer Tools](https://react.dev/learn/react-developer-tools)
- [LangGraph Studio](https://smith.langchain.com/studio)

### 社区资源
- [Stack Overflow](https://stackoverflow.com/questions/tagged/open-canvas)
- [GitHub Discussions](https://github.com/langchain-ai/open-canvas/discussions)
- [LangChain Discord](https://discord.gg/langchain)

---

## 🎯 快速检查清单

### 环境准备 ✅
- [ ] Node.js 20.x 安装
- [ ] Yarn 1.22.22 安装
- [ ] Git 2.30+ 安装
- [ ] VS Code 安装
- [ ] 推荐扩展安装

### 项目配置 ✅
- [ ] 项目克隆
- [ ] 依赖安装
- [ ] 项目构建
- [ ] 环境变量配置
- [ ] Supabase 配置
- [ ] API 密钥配置

### 调试配置 ✅
- [ ] VS Code 调试配置
- [ ] debug-agents.js 创建
- [ ] 日志配置
- [ ] 断点测试
- [ ] LangGraph Studio 访问

### 功能验证 ✅
- [ ] 前端启动 (localhost:3000)
- [ ] 后端启动 (localhost:54367)
- [ ] 用户认证
- [ ] 模型调用
- [ ] 工件生成
- [ ] 调试功能

---

*最后更新时间: 2024年12月*

**配置状态**: 🟢 完整可用  
**推荐指数**: ⭐⭐⭐⭐⭐  
**适用环境**: Windows, macOS, Linux
